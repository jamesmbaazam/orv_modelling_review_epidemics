---
title: "Supplementary material"
output:
  pdf_document:
    fig_crop: no
    keep_tex: yes
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      dev = 'png', 
                      out.height = "\\textheight",  
                      out.width = "\\textwidth", 
                      message = FALSE, 
                      warning = FALSE
                      )

options(kableExtra.auto_format = FALSE)
```

```{r}
#' load packages
suppressPackageStartupMessages({
  library("tidyverse")
  library("scales")
  library("conflicted")
  library("knitr")
  library("here")
  library("kableExtra")
  })

# Resolve package function conflicts
conflict_prefer('filter', 'dplyr')
conflict_prefer('select', 'dplyr')
conflict_prefer('kable', 'knitr')
```

```{r}
# Paths
figs_dir <- "../figs/"
data_dir <- "../data"
scripts_dir <- "../scripts"

# Create a folder for storing the figures

if (!dir.exists(here::here(figs_dir))) {
  dir.create(here::here(figs_dir),
    showWarnings = TRUE
  )
}
```


```{r load_data}
.args <- c(here::here("data", "compact_data_with_citation_keys_cleaned.rds"))
# The data with citations 
compact_data_with_citation_keys <- readRDS(.args[1])
```

```{r}
# Rearrange the columns
compact_data_with_citation_keys <- compact_data_with_citation_keys %>%
  relocate(c(title, bibtexkey), .before = publication_year) %>%
  relocate(publication_year, .before = bibtexkey) %>%
  relocate(c(x0_reviewer, category, author:language),
    .after = collab_type
  )
```


```{r}
# Remove unneeded columns and rearrange the remainder
 final_citation_table <- compact_data_with_citation_keys %>% 
     relocate(c('doi', 'year', 'bibtexkey'), .after = title) %>% 
     select(-c(year_aggreg, x0_reviewer, category, 
               number, pages, journal, publisher, 
               volume, language, month, publication_type, 
               modelling_timing, intervention_type, collab_type,
               author, paper_doi, year, 
               doi, bibtexkey
               )
            ) %>% 
     arrange(desc(publication_year)) %>% 
  mutate(num = seq_len(nrow(.))) %>% 
  relocate(num, .before = "title") 

# Shorten names

names_dict <- c(year = "publication_year",
                affiliation_type = "author_affiliation_type",
                academic_collab = "purely_academic_collab",
                location = "country_studied",
                interventions = "intervention_modelled"
                )

# Remove underscores
final_citation_table <- final_citation_table %>% 
  rename(names_dict) |> 
  mutate(
    across(!where(is.logical) | !where(is.numeric), 
      ~str_replace_all(., "_", " ")
      )
    )
```

```{r helper_functions}
#' Function to print the table caption using a template 
#' It extracts the column names and combines them into a comma-separated
#' list and attaches a preceding sentence, which defaults to 
#' ""List of included studies by:""
make_table_caption <- function(df, preceding_sentence = "List of included studies by:"){
  paste(preceding_sentence, paste(names(df)[-c(1)], collapse = ", "))
} 
```
The following table contains information on the data extracted from
each of the included studies. 

Technical note: Due to the large number of 
rows, the table could not be printed in one go and was instead printed a few columns 
at a time. In actual fact, it is just a repetition of the title column along with
the presented columns.

## Table 1

This section presents extracted data on the author affiliation type (affiliation_type), 
whether it is a purely academic collaboration (academic_collab), and the location
that was studied.

```{r cols_1_to_6}
# Make a neat table of papers from columns 1(title)-5
cols_1_to_6 <- final_citation_table %>% 
    select(1:6) 

knitr::kable(cols_1_to_6, 
    format = "latex", 
    booktabs = TRUE,
    longtable = TRUE
    # caption = make_table_caption(cols_1_to_6)
    ) %>% 
  kableExtra::kable_styling(latex_options = c("striped", 
                                  "scale_down", 
                                  "hold_position", 
                                  "repeat_header"),
                            font_size = 9
                ) %>% 
  kableExtra::column_spec(column = c(2), width = "4cm") %>% 
  kableExtra::landscape() 
```

## Table 2

This section presents extracted data on the disease studied (disease), 
type of objective studied (objectives), whether the paper had an author in
the location studied (author_in_country_studied), and how individuals were 
represented (individual_representation).

```{r cols_7_to_10}
# Make a neat table of papers from columns 1, 2 (title), and 7-10
cols_7_to_10 <- final_citation_table %>% 
    select(c(1, 2, 7:10))

knitr::kable(cols_7_to_10, 
    format = "latex", 
    booktabs = TRUE,
    longtable = TRUE
    # caption = make_table_caption(cols_7_to_10)
    ) %>% 
  kableExtra::kable_styling(latex_options = c("striped", 
                                  "scale_down", 
                                  "hold_position", 
                                  "repeat_header"),
                            font_size = 9
                ) %>% 
  kableExtra::column_spec(column = c(2, 4), width = "4cm") %>% 
  kableExtra::landscape() 
```
## Table 3

This section presents extracted data on whether spatial heterogeneity was
represented (space_representation), the type of model structure 
(model_structure), the type of parametrization and validation method used.

```{r cols_11_to_14}
# Make a neat table of papers from columns 1, 2 (title) and 11-15
cols_11_to_14 <- final_citation_table %>% 
    select(c(1, 2, 11:14))

knitr::kable(cols_11_to_14, 
    format = "latex", 
    booktabs = TRUE,
    longtable = TRUE
    # caption = make_table_caption(cols_11_to_14)
    ) %>% 
  kableExtra::kable_styling(latex_options = c("striped", 
                                  "scale_down", 
                                  "hold_position", 
                                  "repeat_header"),
                            font_size = 9
                ) %>% 
  kableExtra::column_spec(column = c(2, 4), width = "4cm") %>% 
  kableExtra::landscape() 
```
## Table 4

This section presents extracted data on the type of outbreak and the interventions 
studied.

```{r cols_15_to_16}
# Make a neat table of papers from columns 1, 2 (title) and 15-18
cols_15_to_16 <- final_citation_table %>% 
    select(c(1, 2, 15:16))

knitr::kable(cols_15_to_16, 
    format = "latex", 
    booktabs = TRUE,
    longtable = TRUE
    ) %>% 
  kableExtra::kable_styling(latex_options = c("striped", 
                                  "scale_down", 
                                  "hold_position", 
                                  "repeat_header"),
                            font_size = 9
                ) %>% 
  kableExtra::column_spec(column = c(2, 4), width = "4cm") %>% 
  kableExtra::landscape() 
```
## Table 5

This section presents extracted data on whether vaccination was modelled as 
a sole intervention for comparison against other interventions 
(vax_modelled_with_non_vax) and the studies' conclusion on the impact of 
vaccination (is_vax_effective).

```{r cols_17_to_18}
# Make a neat table of papers from columns 1, 2 (title) and 19-24
cols_17_to_18 <- final_citation_table %>% 
    select(c(1, 2, 17:18))

knitr::kable(cols_17_to_18, 
    format = "latex", 
    booktabs = TRUE,
    longtable = TRUE
    # caption = make_table_caption(cols_1_to_6)
    ) %>% 
  kableExtra::kable_styling(latex_options = c("striped", 
                                  "scale_down", 
                                  "hold_position", 
                                  "repeat_header"),
                            font_size = 9
                ) %>% 
  kableExtra::column_spec(column = c(2, 4), width = "4cm") %>% 
  kableExtra::landscape() 
```

## Table 6

This section presents extracted data on the outcomes measured and whether a 
sensitivity analysis was conducted.

```{r cols_19_to_20}
# Make a neat table of papers from columns 1, 2 (title) and 19-24
cols_19_to_20 <- final_citation_table %>% 
    select(c(1, 2, 19:20))

knitr::kable(cols_19_to_20, 
    format = "latex", 
    booktabs = TRUE,
    longtable = TRUE
    # caption = make_table_caption(cols_1_to_6)
    ) %>% 
  kableExtra::kable_styling(latex_options = c("striped", 
                                  "scale_down", 
                                  "hold_position", 
                                  "repeat_header"),
                            font_size = 9
                ) %>% 
  kableExtra::column_spec(column = c(2, 4), width = "4cm") %>% 
  kableExtra::landscape() 
```

## Table 7

This section presents extracted data on whether observed data was used for 
model validation (data_used), and whether the data was made available 
(data_available).

```{r cols_21_to_22}
# Make a neat table of papers from columns 1, 2 (title) and 19-24
cols_21_to_22 <- final_citation_table %>% 
    select(c(1, 2, 21:22))

knitr::kable(cols_21_to_22, 
    format = "latex", 
    booktabs = TRUE,
    longtable = TRUE
    ) %>% 
  kableExtra::kable_styling(latex_options = c("striped", 
                                  "scale_down", 
                                  "hold_position", 
                                  "repeat_header"),
                            font_size = 9
                ) %>% 
  kableExtra::column_spec(column = c(2, 4), width = "4cm") %>% 
  kableExtra::landscape() 
```
## Table 8

This section presents extracted data on whether the simulation code was made 
available (simulation_code_available) and whether vaccination was modelled 
(vax_modelled).

```{r cols_23_to_24}
# Make a neat table of papers from columns 1, 2 (title) and 19-24
cols_23_to_24 <- final_citation_table %>% 
    select(c(1, 2, 23:24))

knitr::kable(cols_23_to_24, 
     format = "latex",
     booktabs = TRUE,
     longtable = TRUE
   ) %>% 
  kableExtra::kable_styling(latex_options = c("striped", 
                                  "scale_down", 
                                  "hold_position", 
                                  "repeat_header"),
                            font_size = 9
                ) %>% 
  kableExtra::column_spec(column = c(2, 4), width = "4cm") %>% 
  kableExtra::landscape() 
```
