---
output: 
  pdf_document:
    df_print: kable
    latex_engine: xelatex
    keep_tex: true
---
```{r setup, include=FALSE}
# options(kableExtra.auto_format = FALSE,
#         knitr.table.format = "latex"
#         )

knitr::opts_chunk$set(echo = FALSE, 
                      include = FALSE,
                      # dev = 'jpeg', 
                      fig.width = 8, 
                      fig.height = 6, 
                      message = FALSE,
                      warning = FALSE,
                      cache = FALSE
                      )
```

```{r}
#' load packages
suppressPackageStartupMessages({
  library("tidyverse")
  library("scales")
  library("conflicted")
  library("knitr")
  library("here")
  library("kableExtra")
  })

# Resolve package function conflicts
conflict_prefer('filter', 'dplyr')
conflict_prefer('select', 'dplyr')
conflict_prefer('kable', 'knitr')
```

```{r}
here::i_am("analyses/scripts/full_data_extraction_citation_table.Rmd")
#I/O paths
figs_dir <- "analyses/figs"
data_dir <- "analyses/data"
scripts_dir <- "analyses/scripts"

# Create a folder for storing the figures

if (!dir.exists(here::here(figs_dir))) {
  dir.create(here::here(figs_dir),
    showWarnings = TRUE
  )
}
```


```{r load_data}
#' re-run the data cleaning step, in case something has changed 
#' TO DO: Use GNU make for this

source(here::here(scripts_dir, "orv_models_review_data_cleaning.R"))

# The data with citations 
compact_data_with_citation_keys <- read_rds(
  here::here(data_dir, 'compact_data_with_citation_keys_cleaned.rds'
  ))
```

```{r}
# Rearrange the columns
compact_data_with_citation_keys <- compact_data_with_citation_keys %>%
  relocate(c(title, bibtexkey), .before = publication_year) %>%
  relocate(publication_year, .before = bibtexkey) %>%
  relocate(c(x0_reviewer, category, author:language),
    .after = collab_type
  )
```


```{r}
# Remove unneeded columns and rearrange the remainder
 final_citation_table <- compact_data_with_citation_keys %>% 
     relocate(c('doi', 'year', 'bibtexkey'), .after = title) %>% 
     select(-c(year_aggreg, x0_reviewer, category, 
               number, pages, journal, publisher, 
               volume, language, month, publication_type, 
               modelling_timing, intervention_type, collab_type,
               author, paper_doi, year, 
               doi, bibtexkey
               )
            ) %>% 
     arrange(desc(publication_year))
```

```{r}
# Make a neat table of papers from columns 1(title)-5
final_citation_table %>% 
    select(1:5) %>% 
    kable()

# booktabs = TRUE,
#       longtable = FALSE#,
#       # caption = 'Extracted data per paper: publication_year, author_affiliation_type, country_studied, author_in_country_studied.'
#          ) %>%
#     kable_styling(latex_options = c('striped',
#                                     'scale_down',
#                                     'hold_position',
#                                     'repeat_header'
#                                     )
#                   ) %>%
#     column_spec(column = c(1, 3), width = "5cm") #%>%
    # landscape()
```


<!--  ```{r} -->
<!-- # Make a neat table of papers from columns 1 (title), and 6-10  -->
<!-- final_citation_table %>% -->
<!--   select(c(1, 6:10)) %>% -->
<!--   kable( -->
<!--     booktabs = TRUE, -->
<!--     longtable = FALSE, -->
<!--     caption = "Extracted data per paper: disease, objectives, individual_representation, space_representation, model_structure." -->
<!--   ) %>% -->
<!--   kable_styling(latex_options = c("striped",  -->
<!--                                   "scale_down",  -->
<!--                                   "hold_position",  -->
<!--                                   "repeat_header" -->
<!--                                   ) -->
<!--                 ) %>% -->
<!--   column_spec(column = c(1), width = "5cm") %>% -->
<!--   landscape() -->
<!-- ``` -->

<!-- ```{r} -->
<!-- # Make a neat table of papers from columns 1 (title) and 11-15  -->
<!-- final_citation_table %>% -->
<!--   select(1, 11:15) %>% -->
<!--   kable( -->
<!--     longtable = FALSE, -->
<!--     caption = "Extracted data per paper: parametrization, validation, outbreak_type, intervention_modelled, vax_modelled_with_non_vax." -->
<!--   ) %>% -->
<!--   kable_styling(latex_options = c("striped",  -->
<!--                                   "scale_down",  -->
<!--                                   "hold_position",  -->
<!--                                   "repeat_header" -->
<!--                                   ) -->
<!--                 ) %>% -->
<!--   column_spec(column = c(1, 2, 5), width = "4cm") %>% -->
<!--   landscape() -->
<!-- ``` -->

<!--  ```{r} -->
<!-- # Make a neat table of papers from columns 1 (title) and 16-22 -->
<!-- final_citation_table %>% -->
<!--   select(1, 16:22) %>% -->
<!--   kable( -->
<!--     booktabs = TRUE, -->
<!--     longtable = FALSE, -->
<!--     caption = "Extracted data per paper: is_vax_effective, outcome_measured, sensitivity_analysis, data_used, data_available, simulation_code_available, vax_modelled." -->
<!--   ) %>% -->
<!--   kable_styling(latex_options = c("striped", -->
<!--                                   "scale_down",  -->
<!--                                   "hold_position",  -->
<!--                                   "repeat_header" -->
<!--                                   ) -->
<!--                 ) %>% -->
<!--   column_spec(column = c(1, 3), width = "5cm") %>% -->
<!--   landscape() -->
<!-- ``` -->
